<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TU Reatuarant Helper</title>

  <link rel="stylesheet" href="..//CSS/dessert.css">
</head>
<body>

    <header>
        <div class="top-bar">
          <div class="search-box">
            <input type="text" placeholder="ค้นหาเมนู...">
              <button class="search-btn" aria-label="ค้นหา">
                <img src="../src-front/Icon/search-interface-symbol.png" alt="" />
              </button>
          </div>
          
          <div class="cart-icon">
            <img src="../src-front/Icon/shopping-cart.png" 
                 alt="Cart Icon" 
                 onclick="window.location.href='Summary.html'" 
                 style="cursor:pointer; filter: brightness(0) invert(1);"
            >
            <span id="cartBadge" class="badge" aria-label="จำนวนในตะกร้า">0</span>
          </div>
        </div>

        <div class="categories">
          <button onclick="window.location.href='Home.html'">อาหารจานเดียว</button>
          <button onclick="window.location.href='beverage.html'">เครื่องดื่ม</button>
          <button class="active">ของทานเล่น</button>
        </div>
  </header>

  <section class="menu-list">
    <div class="menu-item" data-id="1">
      <div class="image-box">
        <img src="../src-front/img-dessert/nugget.webp" alt="นักเก็ต">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>นักเก็ต</p>
      <p class="price">40 บาท</p>
    </div>
    
    <div class="menu-item" data-id="2">
      <div class="image-box">
        <img src="../src-front/img-dessert/pop chicken.jpg" alt="ไก่ป๊อป">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>ไก่ป๊อป</p>
      <p class="price">40 บาท</p>
    </div>
    
    <div class="menu-item" data-id="3">
      <div class="image-box">
        <img src="../src-front/img-dessert/french fries.jpg" alt="เฟรนช์ฟรายส์">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>เฟรนช์ฟรายส์</p>
      <p class="price">40 บาท</p>
    </div>
    
    <div class="menu-item" data-id="4">
      <div class="image-box">
        <img src="../src-front/img-dessert/cheese ball.jpg" alt="ชีสบอล">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>ชีสบอล</p>
      <p class="price">50 บาท</p>
    </div>
    
    <div class="menu-item" data-id="5">
      <div class="image-box">
        <img src="../src-front/img-dessert/sausages.jpg" alt="ไส้กรอกทอด">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>ไส้กรอกทอด</p>
      <p class="price">40 บาท</p>
    </div>
    
    <div class="menu-item" data-id="6">
      <div class="image-box">
        <img src="../src-front/img-dessert/potato.webp" alt="มันบดอบชีส">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>มันบดอบชีส</p>
      <p class="price">65 บาท</p>
    </div>
    
    <div class="menu-item" data-id="7">
      <div class="image-box">
        <img src="../src-front/img-dessert/Chicken-wings.jpg" alt="ปีกไก่ทอด">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>ปีกไก่ทอด</p>
      <p class="price">55 บาท</p>
    </div>
    
    <div class="menu-item" data-id="8">
      <div class="image-box">
        <img src="../src-front/img-dessert/เกี๊ยว.jpg" alt="เกี๊ยวซ่า">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>เกี๊ยวซ่า</p>
      <p class="price">60 บาท</p>
    </div>
    
    <div class="menu-item" data-id="9">
      <div class="image-box">
        <img src="../src-front/img-dessert/bread.jpg" alt="ปังปิ้ง">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>ปังปิ้ง</p>
      <p class="price">50 บาท</p>
    </div>
    
    <div class="menu-item" data-id="10">
      <div class="image-box">
        <img src="../src-front/img-dessert/ice creamm.jpg" alt="ไอศกรีม">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>ไอศกรีม</p>
      <p class="price">45 บาท</p>
    </div>
    <div class="menu-item" data-id="11">
      <div class="image-box">
        <img src="../src-front/img-dessert/Choclava.jpg" alt="เค้กลาวา">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>เค้กลาวา</p>
      <p class="price">70 บาท</p>
    </div>
    
    <div class="menu-item" data-id="12">
      <div class="image-box">
        <img src="../src-front/img-dessert/cake.jpg" alt="เค้กหน้านิ่ม">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>เค้กหน้านิ่ม</p>
      <p class="price">75 บาท</p>
    </div>
    
    <div class="menu-item" data-id="13">
      <div class="image-box">
        <img src="../src-front/img-dessert/coconut-cream.webp" alt="บัวลอย">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>บัวลอย</p>
      <p class="price">65 บาท</p>
    </div>
    
    <div class="menu-item" data-id="14">
      <div class="image-box">
        <img src="../src-front/img-dessert/ปาท่องโก๋.png" alt="ปาท่องโก๋">
        <div class="add-btn" data-action="add">+</div>
      </div>
      <p>ปาท่องโก๋</p>
      <p class="price">65 บาท</p>
    </div>
    
  </section>
  
  
  <script src="..//JS/dessert.js"></script>
  <script defer src="..//JS/dessert.hook.js"></script>
  <script type="module" src="..//JS/js/cart.js" defer></script>

  <script type="module">
    import { addToCart, updateCartBadge } from './js/cart.js';
  
    function bindAddButtons(){
      document.querySelectorAll('.menu-item').forEach(card => {
        const id = card.dataset.id;                                      // id จาก data-id
        const name = card.querySelector('p')?.textContent.trim() || '';  // ชื่อจาก <p> แรก
        const priceText = card.querySelector('.price')?.textContent || '0';
        const price = Number(priceText.replace(/[^\d.]/g, '')) || 0;     // ดึงตัวเลขจาก "40 บาท"
        const image = card.querySelector('img')?.getAttribute('src') || '';
  
        const btn = card.querySelector('[data-action="add"]');
        if (btn) {
          btn.addEventListener('click', () => {
            addToCart({ id, name, price, image });
          });
        }
      });
    }
  
    document.addEventListener('DOMContentLoaded', () => {
      updateCartBadge();  // ให้ตัวเลขโชว์ทันทีที่เปิดหน้า
      bindAddButtons();   // ผูกปุ่มทั้งหมด
    });
  </script>

<script>
  (function(){
    const CART_KEY = 'tu_cart';
    const readCart  = () => JSON.parse(localStorage.getItem(CART_KEY) || '[]');
    const writeCart = (c) => localStorage.setItem(CART_KEY, JSON.stringify(c));
    const cartCount = (c) => c.reduce((s,i)=> s + (Number(i.qty)||0), 0);
  
    function updateCartBadge(){
      const badge = document.getElementById('cartBadge');
      if(!badge) return;
      const n = cartCount(readCart());
      badge.textContent = n;
      badge.style.display = n > 0 ? 'inline-flex' : 'none';
    }
  
    function addFromCard(btn){
      const card = btn.closest('.menu-item');
      if(!card) return;
      const id = card.dataset.id;
      const name = card.querySelector('p')?.textContent.trim() || '';
      const priceTxt = card.querySelector('.price')?.textContent || '0';
      const price = Number(priceTxt.replace(/[^\d.]/g,'')) || 0;
      const image = card.querySelector('img')?.getAttribute('src') || '';
  
      const cart = readCart();
      const f = cart.find(x => String(x.id) === String(id));
      if (f) f.qty += 1; else cart.push({ id, name, price, image, qty: 1 });
      writeCart(cart);
      updateCartBadge();
    }
  
    // จับปุ่ม + ที่มี data-action="add" ทุกใบ (ไม่ต้องผูกทีละปุ่ม)
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-action="add"]');
      if (btn) addFromCard(btn);
    });
  
    document.addEventListener('DOMContentLoaded', updateCartBadge);
  })();
  </script>
  
</body>
</html>

