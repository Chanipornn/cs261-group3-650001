<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TU Reatuarant Helper</title>

  <link rel="stylesheet" href="..//CSS/..//CSS/index.css">
</head>
<body>

    <header>
        <div class="top-bar">
          <div class="search-box">
            <input type="text" placeholder="ค้นหาเมนู...">

            <button class="search-btn" aria-label="ค้นหา">
              <img src="../src-front\Icon\search-interface-symbol.png" alt="" />
            </button>
            
          </div>

          <div class="cart-icon">
            <img src="../src-front\Icon\shopping-cart.png" 
                 alt="Cart Icon" 
                 onclick="window.location.href='Summary.html'" 
                 style="cursor:pointer; filter: brightness(0) invert(1);"
            >
            <span id="cartBadge" class="badge" aria-label="จำนวนในตะกร้า">0</span>
          </div>
          
        </div>

    <div class="categories">
      <button class="active">อาหารจานเดียว</button>
      <button onclick="window.location.href='beverage.html'">เครื่องดื่ม</button>
      <button onclick="window.location.href='dessert.html'">ของทานเล่น</button>
    </div>
  </header>

  <section class="menu-list">
    <!-- เมนูจะถูกเติมจาก API ด้วย JS -->
  </section>
  
  <script src="..//JS/index.js"></script>
  <script src="..//JS/index.hook.js"></script>
  <script src="..//JS/fetchMenu.js"></script>
  <script type="module" src="..//JS/cart.js" defer></script>

  <script>
    (function(){
      const CART_KEY = 'tu_cart';
      const readCart  = () => JSON.parse(localStorage.getItem(CART_KEY) || '[]');
      const writeCart = (c) => localStorage.setItem(CART_KEY, JSON.stringify(c));
      const cartCount = (c) => c.reduce((s,i)=> s + (Number(i.qty)||0), 0);
    
      function updateCartBadge(){
        const badge = document.getElementById('cartBadge');
        if(!badge) return;
        const n = cartCount(readCart());
        badge.textContent = n;
        badge.style.display = n > 0 ? 'inline-flex' : 'none';
      }
    
      function addFromCard(btn){
        const card = btn.closest('.menu-item');
        if(!card) return;
        const id = card.dataset.id;
        const name = card.querySelector('p')?.textContent.trim() || '';
        const priceTxt = card.querySelector('.price')?.textContent || '0';
        const price = Number(priceTxt.replace(/[^\d.]/g,'')) || 0;
        const image = card.querySelector('img')?.getAttribute('src') || '';
    
        const cart = readCart();
        const f = cart.find(x => String(x.id) === String(id));
        if (f) f.qty += 1; else cart.push({ id, name, price, image, qty: 1 });
        writeCart(cart);
        updateCartBadge();
      }
    
      // จับปุ่ม + ที่มี data-action="add" ทุกใบ (ไม่ต้องผูกทีละปุ่ม)
      document.addEventListener('click', (e)=>{
        const btn = e.target.closest('[data-action="add"]');
        if (btn) addFromCard(btn);
      });
    
      document.addEventListener('DOMContentLoaded', updateCartBadge);
    })();
    </script>
    

</body>
</html>
